# Mark It Down

Markdownで書く。

AI非対応。プラグインもなし。
1ペイン。書いた瞬間に見える。

**New Tab** — 全画面で。
**Side Panel** — Webの横で。AIの横で。

両方開ける。同期しない。
更新前を見ながら、書き換える。

貼る。見える。削る。書き換える。


テーブル、Mermaid、コードブロック、LaTeX。
貼った瞬間に、完成形。

一時的にNoteをMove

* **Template** — 複製できる

* **Archive** — ロックされる

* **Trash** — 消えない。自分で消す。

いらないファイルはTrashに。SyncすればRemote側だけ削除される。

完全に削除したければLocalで完全削除。

Chrome拡張機能専用ストレージに保存。起動は一瞬。

拡張を消さない限りデータは残る。


Git連携でリモートにも。
エクスポートはいつでも。

書くことに集中しよう。

調べて、書く。自分の言葉にする。
その繰り返しが、自分になる。

***

## 主な機能

### エディタ

* GFM (GitHub Flavored Markdown) 完全対応

* テーブル、チェックリスト、コードブロック

* Mermaid図 (フローチャート、シーケンス図、状態遷移図、円グラフ等) - 🔍ボタンで別タブに拡大表示

* 数式（LaTeX）- インライン `$E=mc^2$` / ブロック `$$...$$`

* **コールアウト** - `> [!NOTE]`, `> [!TIP]`, `> [!IMPORTANT]`, `> [!WARNING]`, `> [!CAUTION]` (GitHub Alerts互換)

* **ページ内リンク** - `[テキスト](#見出し)` でページ内ジャンプ（GitHub互換の見出しID生成）

* **目次（Table of Contents）** - 長いドキュメント用の自動生成目次（両モード対応）

* ダーク/ライトモード

### ノート管理

* 複数ノート管理 (Inbox / Template / Archive / Trash) - 固定4フォルダで定位置管理

* テンプレート機能（Templateフォルダからノートを複製）

* ピン留め機能（重要なノートをフォルダ内の最上部に表示）

* ドラッグ&ドロップでフォルダ間移動

* ソート切替（名前順 / 更新日時順）- フォルダ横の時計アイコンで切替

* インクリメンタル検索

* サイドバーのリサイズ（ドラッグで幅調整、ダブルクリックでリセット）

### ツールバー（スティッキー）

エディタ上部に常に表示されるツールバーで、スクロールしても操作可能。

**情報フロー哲学** (Entry → Work → Move → Exit):

| ボタン        | 機能            | 備考                                                          |
| ---------- | ------------- | ----------------------------------------------------------- |
| **Import** | ファイルインポート     | .md / .zip（Entry: 情報の入り口）                                   |
| **Paste**  | クリップボードから貼り付け | Markdown手動ペースト（Entry）                                       |
| **Undo**   | 元に戻す          | Ctrl+Z（Work: 編集作業）                                          |
| **Redo**   | やり直す          | Ctrl+Y（Work）                                                |
| **Move**   | ノート移動メニュー     | Pin/Unpin, Template, Archive, Trash, Restore（Move: フォルダ間移動） |
| **Export** | ファイルエクスポート    | .md（Exit: 他ツールへ卒業）                                          |
| **Copy**   | クリップボードにコピー   | ノート全体（Exit）                                                 |

**Move メニュー内訳:**

* Pin/Unpin（Alt+P） - フォルダ内ピン留め

* Move to Template（Alt+T） - Templateフォルダへ移動

* Move to Archive（Alt+A） - Archiveフォルダへ移動（編集ロック）

* Move to Trash（Alt+X） - Trashへ移動

* Restore to Inbox - Inbox に復元（Template/Archive/Trash から）

> 💡 **ヒント**: 空のノートでは Import と Paste ボタンがハイライト表示され、すぐに使い始められます。

**Zenモード** (New Tab only):

* ヘッダー右上（Dark Modeの隣）に配置

* F11 または Ctrl+Shift+Z で切替

* サイドバー、ツールバー、すべてのUIを非表示にして書くことに集中

* Escape で解除

### インポート/エクスポート

* ドラッグ&ドロップでインポート (.md / .zip)

* 設定画面から一括エクスポート (Export All → .zip)

### 保存

**自動保存** 入力後0.5秒で自動保存（手動保存は不要）

* **Chrome拡張機能専用ストレージ**（`chrome.storage.local`）に保存されます

* ⚠️ エクスプローラーで.mdファイルとして見ることはできません

* .mdファイルとして取り出すには「Export」機能を使用してください

* ブラウザキャッシュを削除してもデータは消えません（安全）

* 拡張機能を削除するとデータも消えます。定期的にエクスポートまたはGit同期をお勧めします

### Git同期の哲学

Mark It Downは、OneDriveやGoogle Driveのような「自動ファイル同期」とは異なる、

**意図的なバージョン管理**を提供します。

| 項目      | Mark It Down (Git)    | OneDrive/Google Drive |
| ------- | --------------------- | --------------------- |
| ローカル保存  | リアルタイム自動保存 (0.5秒)     | リアルタイム自動保存            |
| リモート同期  | 手動コミット（明示的な操作）        | 自動ファイル同期              |
| バージョン履歴 | Gitコミット履歴（フル差分管理）     | 限定的な版管理               |
| 競合解決    | マージツールで手動選択           | 自動または上書き警告            |
| 制御      | **ユーザーが同期タイミングを完全制御** | 自動・暗黙的                |

**メリット:**

* 📝 **意図的なスナップショット** - 意味のある単位でコミット（「下書き中」と「完成版」を区別）

* 🔍 **完全な履歴追跡** - いつ、何を、なぜ変更したか記録可能

* 🔒 **競合の明示的解決** - 自動上書きなし、必ず確認してから選択

* 🌐 **プラットフォーム非依存** - GitHubアカウントがあれば使用可能

**使い分け:**

* **Mark It Down (Git)**: コード、技術文書、重要な意思決定記録、学習ノート

* **クラウドドライブ**: 写真、動画、PDF、一般的なファイル共有

### ヘルプ機能

* 右サイドバーにヘルプを表示

* 使える記法、保存のしくみ、GitHub連携方法を解説

### デュアルモード（New Tab + Side Panel）

**2つのウィンドウを同時に開いて使えます:**

| 機能          | New Tab | Side Panel |
| ----------- | :-----: | :--------: |
| 全画面で集中執筆    |    ✅    |      -     |
| Webページと並列表示 |    -    |      ✅     |
| Zenモード      |    ✅    |      -     |
| 目次（TOC）     |  サイドパネル |   ドロップダウン  |
| ツールバー       |   フル表示  |    コンパクト   |

**競合解決（WinMerge風）:**

両方で同じノートを編集した場合、**Merge Changes** ボタンが点滅。クリックすると:

* Side-by-side で両方の内容を並べて比較

* 「このウィンドウ」または「他のウィンドウ」どちらを採用するか選択

* Git Pull時の競合解決も同じUIで操作

> 💡 変更前の内容を見ながら編集したい場合、片方のウィンドウでは編集せず、もう片方で編集するのがおすすめ。

## キーボードショートカット

ブラウザのデフォルトショートカットと衝突しないように設計しています。

| ショートカット                | 機能                     |
| ---------------------- | ---------------------- |
| `Alt+N`                | 新規ノート作成                |
| `Ctrl+K`               | 検索モーダル                 |
| `Ctrl+Shift+D`         | サイドバー切替                |
| `Ctrl+Shift+S`         | Git同期 (Commit & Sync)  |
| `F11` / `Ctrl+Shift+Z` | Zenモード切替 (New Tab のみ)  |
| `Escape`               | Zenモード解除               |
| `Alt+P`                | Pin/Unpin（フォルダ内ピン留め切替） |
| `Alt+T`                | Templateへ移動            |
| `Alt+A`                | Archiveへ移動             |
| `Alt+X`                | Trashへ移動               |
| `Ctrl+Z` / `Ctrl+Y`    | 元に戻す / やり直す            |

## Git連携（GitHub/GitLab）

ノートをGitHub/GitLabリポジトリにバックアップできます。

* GitHub/GitLab連携 (Push/Pull)

### 1. Personal Access Token の作成

#### GitHub の場合

1. **トークン作成ページにアクセス**

   ```
   https://github.com/settings/tokens/new
   ```

2. **必要な設定**

   * **Note**: `Mark It Down` など分かりやすい名前

   * **Expiration**: `No expiration` または任意の期限

   * **Scopes**: ✅ `repo` にチェック（プライベートリポジトリの場合）

     * パブリックリポジトリのみなら `public_repo` でOK

3. **トークンをコピー**

   * `ghp_xxxxxxxxxxxxxxxxxxxx` という形式

   * ⚠️ **一度しか表示されません**ので必ずコピーしてください

#### GitLab の場合

1. **トークン作成ページにアクセス**

   ```
   https://gitlab.com/-/user_settings/personal_access_tokens
   ```

2. **必要な設定**

   * **Token name**: `Mark It Down`

   * **Scopes**: ✅ `read_repository` + `write_repository` または `api`

3. **トークンをコピー**

   * `glpat-xxxxxxxxxxxxxxxxxxxx` という形式

### 2. リポジトリの作成

GitHubまたはGitLabでノート保存用のリポジトリを作成します。

**Public vs Private:**

| 種類              | 特徴                        | 推奨度   |
| --------------- | ------------------------- | ----- |
| **Private（推奨）** | 自分だけがアクセス可能。個人情報を含むノートに最適 | ⭐⭐⭐   |
| **Public**      | 誰でも閲覧可能。公開しても問題ないノートのみ    | ⚠️ 注意 |

> 💡 **推奨**: AI出力やメモには個人情報が含まれる可能性があるため、**Privateリポジトリ**の使用を強く推奨します。

### 3. Mark It Down に設定

1. Mark It Downを開き、Source Control右の **⚙️ 設定** アイコンをクリック
2. **Git連携** タブで以下を入力：

   * **プロバイダー**: `GitHub` または `GitLab`

   * **Personal Access Token**: コピーしたトークンを貼り付け

   * **リポジトリ**: リポジトリのURLをコピー&ペースト

     ```
     https://github.com/yourname/my-notes.git
     ```

     ※ `.git` なし、または `yourname/my-notes` の形式でもOK

   * **ブランチ**: `main` または `master`
3. **接続テスト** をクリックして確認
4. 成功したら **保存** をクリック
5. **プッシュ** ボタンでノートをアップロード

### 4. カスタムコミットメッセージ

**コミット時にメッセージをカスタマイズできます**:

* **メッセージ入力**: Source Controlセクションの入力欄にコミットメッセージを入力

* **履歴から選択**: ドロップダウンから過去のメッセージ（最新5件）を選択可能

* **自動生成**: 空欄のままだとタイムスタンプで自動生成 `[2025-12-22T03-41-35] Update notes`

**バッチコミット**:

* すべてのファイル変更が1つのコミットにまとめられます

* GitHub: Git Trees API使用

* GitLab: Commits API使用

### 5. Git Pullでの変更取得

**リモートから変更をプル**:

* **Pull** ボタンで最新の変更を取得

* 成功メッセージ: `X件のファイルを同期しました（Y件作成、Z件の競合）`

* 現在開いているノートが更新された場合、自動的にエディタに反映＋通知表示

**競合解決**:

* ローカルとリモートで同じノートが変更されている場合、競合モーダルが表示

* 差分を確認して、ローカルまたはリモートを選択

* 複数の競合を一度に解決可能

### 6. Discard Changes（変更の破棄）

**ローカルの変更を破棄してリモートの状態に戻す**:

* 設定画面（⚙️）→ Git連携 → **Danger Zone** から実行

* 変更があるノートでのみ「Discard Changes」ボタンが表示

* クリックすると確認ダイアログが表示

* 確認後、最後にPushした時点の内容に戻る

* ⚠️ この操作は元に戻せません

**使い方**:

* 「編集したけど、やっぱり前の状態に戻したい」場合に便利

* Pull前にローカルの変更を捨てたい場合にも使用可能

* **安全のため**: あえて操作しにくい場所に配置（誤クリック防止）-> Source Cotnrolの設定ボタン

### 7. Diff Modal（差分表示）

**リモートとの差分を視覚的に比較**:

* Source Controlセクションで変更があるノートの「Diff」ボタンをクリック

* Side-by-sideでローカルとリモートの内容を比較

* 変更箇所がハイライト表示

### 8. Commit History（コミット履歴）

**過去のコミット履歴を閲覧**:

* Source Controlセクションの「History」ボタンをクリック

* 最新20件のコミット履歴を表示

* コミットメッセージ、日時、変更ファイル数を確認

### 9. 自動ファイル追跡

Mark It Downは、ノートのフォルダ移動やタイトル変更時に、リモート上の古いファイルを自動的に削除します。

**動作:**

* ノートをInboxからArchiveに移動 → `notes/Inbox/note.md`を削除、`notes/Archive/note.md`を作成

* タイトルを「Old Title」→「New Title」に変更 → 旧ファイルを削除、新ファイルを作成

これにより、リモートに重複ファイルが残りません。

### 10. Force Push All（重複ファイルのクリーンアップ）

設定画面の「Danger Zone」から、すべてのローカルノートを強制的にリモートにプッシュできます。

**用途:**

* 重複ファイルのクリーンアップ

* 全体的な再同期

⚠️ **注意:**

* この操作はリモートの状態を上書きします

* 2段階の確認（警告メッセージ + チェックボックス）が必要

* 使用は慎重に

* **安全のため**: あえて操作しにくい場所に配置（誤クリック防止）-> Source Cotnrolの設定ボタン

### 11. ノート削除の仕組み（2段階削除）

Mark It Downは安全性を重視した2段階削除を採用しています：

**削除の流れ**:

1. **Trash へ移動** (`Alt+X` または ドラッグ&ドロップ)

   * ローカル: ストレージに残る（復元可能）

   * リモート: 次回Push時に削除される
2. **Restore（復元）**

   * Trash内のノートをInboxに戻す

   * Push前に復元すれば、リモートファイルは残る
3. **Delete Permanently（完全削除）**

   * Trash内のノートをストレージから完全削除

   * **復元不可**

**詳細**: Git同期ロジックの詳細は [`doc/git-sync-flowchart.md`](doc/git-sync-flowchart.md) を参照。

### 12. セキュリティ

* トークンは **AES-GCM暗号化** されて `chrome.storage.local` に保存されます

* 平文では保存されません

* トークンは定期的に更新することをお勧めします

### 13. Markdown記法の詳細

#### コールアウト

GitHub互換のGitHub Alerts記法をサポート。ライト/ダークモードに対応した色分け表示。

```markdown
> [!NOTE]
> 補足情報や注釈

> [!TIP]
> 便利なヒントやコツ

> [!IMPORTANT]
> 重要な情報

> [!WARNING]
> 警告や注意事項

> [!CAUTION]
> 危険な操作や重大な注意
```

#### ページ内リンク（Internal Links）

見出しへのリンクを作成できます。**GitHub互換**の見出しID生成アルゴリズムを使用。

**見出しID生成ルール**:

1. すべて小文字に変換
2. a-z, 0-9, 日本語（ひらがな・カタカナ・漢字）、韓国語、中国語、スペース、ハイフンを保持
3. それ以外（絵文字、記号など）を削除
4. スペースをハイフンに変換

**例**:

| 見出し                | 生成されるID         | リンク                      |
| ------------------ | --------------- | ------------------------ |
| `## Mermaid図`      | `mermaid図`      | `[Mermaid図](#mermaid図)`  |
| `## 数式`            | `数式`            | `[数式](#数式)`              |
| `## 📖 目次`         | `目次`            | `[目次](#目次)` (絵文字削除)      |
| `## LaTeX Support` | `latex-support` | `[Link](#latex-support)` |

> **制限**: 見出しには空白や絵文字、記号を使用できません。
> 見出し「## 📖 目次」へのリンクは `[目次](#目次)` と記述します（絵文字を省略）。

## 技術スタック

* **フレームワーク**: Preact

* **エディタ**: Milkdown Crepe (ProseMirror + CodeMirror)

* **状態管理**: Zustand

* **スタイリング**: Tailwind CSS

* **ダイアグラム**: Mermaid.js

* **i18n**: Chrome i18n API（英語/日本語）

* **セキュリティ**: DOMPurify, Web Crypto API (AES-GCM)

* **テスト**: Vitest

* **ビルド**: Vite

* **言語**: TypeScript

## 重要: アンインストール前の注意

**拡張機能を削除すると、保存されたすべてのノートが消失します。**

Mark It Downのデータは`chrome.storage.local`に保存されており、拡張機能をアンインストールするとデータも削除されます。

アンインストールする前に、必ず以下のいずれかでバックアップを取ってください：

1. **全ノートをZIPエクスポート**: 設定画面 → 「全ノートをZIPでエクスポート」
2. **GitHubにプッシュ**: 設定画面 → GitHub連携 → 「Push」

大切なノートを失わないよう、定期的なエクスポートをお勧めします。

<br />

#

